## http://r.789695.n4.nabble.com/lme4-How-to-specify-nested-factors-meaning-of-and-in-td853351.html

install.packages('gsheet')

library(gsheet)
rats <- read.csv(text = 
                   gsheet2text('https://drive.google.com/open?id=1bAXU6OKVtaC1pVf5dAI2ihXQJTaW_71zah_Ikos1kDw',
                               format ='csv'))
head(rats)
str(rats)
rats$Treatment <- as.factor(rats$Treatment)
rats$Liver <- as.factor(rats$Liver)
rats$Rat <- as.factor(rats$Rat)
boxplot(Glycogen ~ Treatment, rats)

## ANOVA:

# Treatment - Fixed Factor:
fit1 <- aov(Glycogen ~ Treatment + Error(Rat/Liver), rats) 
summary(fit1)
fit1
# CONCLUSION: Treatment 2 is statistically significant

# Rats - random factor:
fit1a <- aov(Glycogen ~ Treatment + Rat + Error(Liver), rats) 
summary(fit1a)
# CONCLUSION: significant glycogen variation between rats.

# Liver - random factor:
fit1b <- aov(Glycogen ~ Treatment + Rat + Liver, rats) 
summary(fit1b)
# CONCLUSION: No signif variation between liver preparations.

## MIXED EFFECTS:

require(lme4)
fit2<-lmer(Glycogen~Treatment+(1|Rat/Liver), rats)
summary(fit2); anova(fit2); confint(fit2)

# CONCLUSIONS: Variations between rats > between liver preps.



plot(resid(fit2) ~ fitted(fit2))
# No patterns

require(nlme)
fit3<-lme(Glycogen~Treatment, random=~1|Rat/Liver, rats)
summary(fit3); anova(fit3); VarCorr(fit3)


